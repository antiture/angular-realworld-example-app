è¿™ä¸ªæ–‡ä»¶å¤¹ä½ç½®åœ¨åšä»€ä¹ˆ

è·¯å¾„ï¼š
src/app/core/interceptors/api.interceptor.ts
è¿™æ˜¯ä¸€ä¸ªå…¸å‹ Angular Core å±‚ç»“æ„ã€‚
core/ çš„è¯­ä¹‰ï¼ˆå·¥ç¨‹å…±è¯†ï¼‰
core = åº”ç”¨çº§åŸºç¡€è®¾æ–½ï¼ˆå…¨å±€ã€å•ä¾‹ã€æ¨ªåˆ‡å…³æ³¨ç‚¹ï¼‰

åªæ”¾ â€œå…¨ App å…±äº«â€ çš„ä¸œè¥¿ï¼š
interceptorsï¼ˆæ‹¦æˆªå™¨ï¼‰
auth / token
error handling
guards
å…¨å±€ services

ğŸ‘‰ ä¸å…è®¸å‡ºç°ä¸šåŠ¡ã€é¡µé¢ã€feature é€»è¾‘ã€‚
2ï¸âƒ£ interceptors è¿™ä¸€å±‚çš„èŒè´£å®šä½
Interceptor = HTTP Pipeline ä¸­çš„ Middleware

å¯¹æ ‡ï¼š
Angular HttpInterceptor
â†”
ASP.NET Core Middleware / DelegatingHandler


å…¸å‹ç”¨é€”
Base URL
Auth Header
Retry / Timeout
Error normalization
Logging / tracing

3ï¸âƒ£ è¿™æ®µä»£ç åœ¨å¹²ä»€ä¹ˆï¼ˆé€è¡Œï¼‰
import { HttpInterceptorFn } from '@angular/common/http';

Angular 15+ æ–°å†™æ³•
å‡½æ•°å¼ interceptor
æ›¿ä»£ class + implements
export const apiInterceptor: HttpInterceptorFn = (req, next) => {

reqï¼šä¸å¯å˜ HttpRequest
nextï¼šä¸‹ä¸€ä¸ª interceptor / backend

è´£ä»»é“¾æ¨¡å¼

const apiReq = req.clone({
  url: `https://api.realworld.show/api${req.url}`,
});


å…³é”®ç‚¹ï¼š

HttpRequest æ˜¯ immutable
æ‰€æœ‰ä¿®æ”¹å¿…é¡» clone
è¿™é‡Œåšçš„æ˜¯ï¼š
relative url
â†’ absolute api base url
return next(apiReq);
æŠŠâ€œæ”¹è¿‡çš„è¯·æ±‚â€äº¤ç»™ä¸‹æ¸¸
ä¸åœ¨è¿™é‡Œ subscribe
ä¸åœ¨è¿™é‡Œå¤„ç†ä¸šåŠ¡

4ï¸âƒ£ è¿™ä¸ª interceptor çš„èŒè´£è¾¹ç•Œ
âœ… åˆæ³•è¡Œä¸º
âœ” æ‹¼æ¥ base URL
âœ” æ”¹ header
âœ” æ”¹ params
âœ” è½¬å‘è¯·æ±‚

âŒ è¿è§„è¡Œä¸º
âœ˜ if/else ä¸šåŠ¡åˆ¤æ–­
âœ˜ è°ƒå…¶ä»– service
âœ˜ æ˜ å°„ DTO
âœ˜ ç®¡ç†çŠ¶æ€


ä¸€å¥è¯ï¼š

Interceptor = çº¯æŠ€æœ¯æ¨ªåˆ‡å±‚

5ï¸âƒ£ å†™ä½œä¹ æƒ¯ï¼ˆè¿™æ˜¯â€œæˆç†Ÿ Angularâ€çš„ä¿¡å·ï¼‰
â‘  æ–‡ä»¶å‘½å
api.interceptor.ts
error.interceptor.ts
token.interceptor.ts


ä¸€ä¸ªæ–‡ä»¶ = ä¸€ä¸ªå…³æ³¨ç‚¹

ä¸æâ€œä¸‡èƒ½ interceptorâ€

â‘¡ ä½¿ç”¨ HttpInterceptorFnï¼ˆè€Œä¸æ˜¯ classï¼‰

åŸå› ï¼š

âœ” æ— çŠ¶æ€
âœ” æ˜“æµ‹è¯•
âœ” æ˜“ç»„åˆ
âœ” æ›´å‡½æ•°å¼ï¼ˆåƒ Rxï¼‰

â‘¢ ä¸ hard-code åœ¨ service

âŒ é”™è¯¯ç¤ºä¾‹ï¼š

this.http.get('https://api.xxx.com/users')


âœ… æ­£ç¡®åšæ³•ï¼š
this.http.get('/users')
Base URL ç»Ÿä¸€åœ¨ interceptor
6ï¸âƒ£ åœ¨æ•´ä½“æ¶æ„ä¸­çš„ä½ç½®ï¼ˆä¸ä½ å‰é¢çš„å›¾å®Œå…¨ä¸€è‡´ï¼‰
[Component]
   â†“
[Facade]
   â†“
[Http Service]
   â†“
[Interceptor]   â† ä½ ç°åœ¨çœ‹çš„å°±æ˜¯è¿™é‡Œ
   â†“
[Angular HttpClient]


ğŸ‘‰ å®ƒåœ¨ HTTP API åˆ‡å‰²çº¿ä¹‹ä¸‹ï¼Œä½†ä»å±äºå‰ç«¯
7ï¸âƒ£ å’Œ .NET çš„ç²¾ç¡®å¯¹ç…§
Angular api.interceptor
â†”
ASP.NET Core Middleware
â†”
HttpClient DelegatingHandler

8ï¸âƒ£ ä¸€å¥è¯æ€»ç»“ï¼ˆå·¥ç¨‹è§†è§’ï¼‰
è¿™ä¸ªæ–‡ä»¶å­˜åœ¨çš„æ„ä¹‰æ˜¯ï¼š
æŠŠâ€œHTTP æŠ€æœ¯ç»†èŠ‚â€ä» Facade / Service ä¸­å½»åº•å‰¥ç¦»

ä½ ç°åœ¨çœ‹çš„è¿™ä¸ª repoï¼ˆrealworld angularï¼‰ï¼š
æ¶æ„æ˜¯ æ­£ç¡®çš„

